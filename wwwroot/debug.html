<!DOCTYPE html>
<html>
<head>
    <title>A-eye Debug Console</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles/debug.css">
</head>
<body>
    <div class="debug-layout">
        <div class="controls">
            <h1>🔧 A-eye Debug Console</h1>

            <!-- EXPRESSIONS -->
            <div class="section">
                <div class="section-header">Expressions</div>
                <div class="btn-grid" id="expr-buttons"></div>
            </div>

            <!-- EYE -->
            <div class="section">
                <div class="section-header">Eye</div>
                <div class="slider-row">
                    <label>Scale <span class="slider-value" id="scale-val">100%</span></label>
                    <input type="range" id="scale" min="5" max="100" step="1" value="100">
                </div>
                <div class="slider-row">
                    <label>Bar Count <span class="slider-value" id="barCount-val">20</span></label>
                    <input type="range" id="barCount" min="8" max="120" step="1" value="20">
                </div>
                <div class="slider-row">
                    <label>Gap Ratio <span class="slider-value" id="gapRatio-val">0.2</span></label>
                    <input type="range" id="gapRatio" min="0" max="1" step="0.05" value="0.2">
                </div>
            </div>

            <!-- PUPIL -->
            <div class="section">
                <div class="section-header">Pupil</div>
                <div class="slider-row">
                    <label>Dilation <span class="slider-value" id="dilation-val">0.0</span></label>
                    <input type="range" id="dilation" min="-1" max="1" step="0.05" value="0">
                </div>
                <div class="slider-row">
                    <label>Iris X Offset <span class="slider-value" id="irisXOffset-val">0.0</span></label>
                    <input type="range" id="irisXOffset" min="-1" max="1" step="0.05" value="0">
                </div>
                <div class="slider-row">
                    <label>Iris Y Offset <span class="slider-value" id="irisYOffset-val">0.0</span></label>
                    <input type="range" id="irisYOffset" min="-1" max="1" step="0.05" value="0">
                </div>
            </div>

            <!-- WAVE -->
            <div class="section">
                <div class="section-header">Traveling Wave</div>
                <div class="slider-row">
                    <label>Top Speed <span class="slider-value" id="topSampleSpeed-val">-0.1</span></label>
                    <input type="range" id="topSampleSpeed" min="-1" max="1" step="0.1" value="-0.1">
                </div>
                <div class="slider-row">
                    <label>Bottom Speed <span class="slider-value" id="bottomSampleSpeed-val">0.1</span></label>
                    <input type="range" id="bottomSampleSpeed" min="-1" max="1" step="0.1" value="0.1">
                </div>
            </div>

            <!-- STATE -->
            <div class="section">
                <div class="section-header">State</div>
                <div class="toggle-row">
                    <input type="checkbox" autocomplete="off" id="unhinged-toggle">
                    <label for="unhinged-toggle">Unhinged (predatory)</label>
                </div>
                <div class="toggle-row">
                    <input type="checkbox" autocomplete="off" id="loading-toggle">
                    <label for="loading-toggle">Loading (reading)</label>
                </div>
                <div class="toggle-row">
                    <input type="checkbox" autocomplete="off" id="blink-toggle" checked>
                    <label for="blink-toggle">Blinking</label>
                </div>
                <div class="toggle-row">
                    <input type="checkbox" autocomplete="off" id="track-toggle" checked>
                    <label for="track-toggle">Cursor tracking</label>
                </div>
                <div class="toggle-row">
                    <input type="checkbox" autocomplete="off" id="crosshair-toggle">
                    <label for="crosshair-toggle">Show crosshair</label>
                </div>
                <div class="toggle-row">
                    <input type="checkbox" autocomplete="off" id="sleep-toggle">
                    <label for="sleep-toggle">Auto-sleep</label>
                </div>
            </div>

            <!-- BLINK -->
            <div class="section">
                <div class="section-header">Blink</div>
                <div class="btn-grid">
                    <button id="blink-btn">Blink</button>
                    <button id="sleep-btn">Sleep</button>
                    <button id="wake-btn">Wake</button>
                    <button id="poke-btn">Poke (anger)</button>
                </div>
            </div>

            <!-- JINGLES -->
            <div class="section">
                <div class="section-header">Audio</div>
                <div class="btn-grid">
                    <button class="jingle-btn" onclick="playRandomJingle()">🎵 Random</button>
                    <button class="jingle-btn" onclick="playZeldaSecretJingle()">🎵 Zelda</button>
                    <button class="jingle-btn" onclick="playAchievementSound()">🎵 Achievement</button>
                </div>
            </div>

            <!-- TAGLINE -->
            <div class="section">
                <div class="section-header">Tagline</div>
                <div class="btn-grid">
                    <button id="tag-positive">Positive</button>
                    <button id="tag-negative">Negative</button>
                </div>
                <div id="tagline-display">
                    <div id="tagline"></div>
                </div>
            </div>

            <!-- STATE READOUT - add after the other sections in .controls -->
            <div class="section">
                <div class="section-header">Live State</div>
                <pre id="state-readout" style="
                    background: #000;
                    padding: 10px;
                    font-family: monospace;
                    font-size: 9px;
                    color: #0f0;
                    overflow: hidden;
                    line-height: 1.4;
                "></pre>
            </div>
        </div>

        <div class="eye-container">
            <svg id="eye"></svg>
            <svg id="debug-overlay" style="position: absolute; pointer-events: none; display: none;">
                <line id="debug-x-axis" stroke="red" stroke-width="1" />
                <line id="debug-y-axis" stroke="red" stroke-width="1" />
            </svg>
        </div>
    </div>

    <script src="scripts/utils.js"></script>
    <script src="scripts/txt.js"></script>
    <script src="scripts/audio.js"></script>
    <script src="scripts/tracker.js"></script>
    <script src="scripts/sfx.js"></script>
    <script src="scripts/eye.js"></script>
    <script>
        // Initialize
        window.svg = document.getElementById('eye');
        state.sleepTimeout = Infinity;
        wake();

        // Expression buttons
        const exprGrid = document.getElementById('expr-buttons');
        for (const name of Object.keys(expressions)) {
            const btn = document.createElement('button');
            btn.textContent = name;
            btn.addEventListener('click', () => {
                exprGrid.querySelectorAll('button').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                setExpression(name);
            });
            exprGrid.appendChild(btn);
        }

        // Dilation
        document.getElementById('dilation').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            document.getElementById('dilation-val').textContent = val.toFixed(2);
            setDilation(val);
        });

        // Iris position (manual override)
        document.getElementById('irisXOffset').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            document.getElementById('irisXOffset-val').textContent = val.toFixed(2);
            state.targetX = val;
            state.attention = 1;
        });

        document.getElementById('irisYOffset').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            document.getElementById('irisYOffset-val').textContent = val.toFixed(2);
            state.targetY = val;
            state.attention = 1;
        });

        // Wave speeds
        document.getElementById('topSampleSpeed').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            document.getElementById('topSampleSpeed-val').textContent = val.toFixed(1);
            state.topSampleSpeed = val;
        });

        document.getElementById('bottomSampleSpeed').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            document.getElementById('bottomSampleSpeed-val').textContent = val.toFixed(1);
            state.bottomSampleSpeed = val;
        });

        document.getElementById('unhinged-toggle').addEventListener('change', (e) => {
            setUnhinged(e.target.checked);
        });

        document.getElementById('loading-toggle').addEventListener('change', (e) => {
            setLoading(e.target.checked);
        });

        // Blink controls
        document.getElementById('blink-btn').addEventListener('click', () => blink());
        document.getElementById('sleep-btn').addEventListener('click', () => snooze());
        document.getElementById('wake-btn').addEventListener('click', () => wake());
        document.getElementById('poke-btn').addEventListener('click', () => {
            blink();
            state.poked = true;
            state.attentionThreshold *= state.patience;
            if (state.attentionThreshold < 10) {
                setPeeved(true, true, false, 0, -0.4);
                setExpression('angry');
            }
        });

        // Tagline controls
        const tagDisplay = document.getElementById('tagline-display');

        document.getElementById('tag-positive').addEventListener('click', () => {
            setRandomTagline(0);
        });
        document.getElementById('tag-negative').addEventListener('click', () => {
            setRandomTagline(1);
        });

        // Add to the script section
        function updateStateReadout() {
            const el = document.getElementById('state-readout');
            if (!el) return;

            el.textContent = `attention: ${state.attention.toFixed(3)}
                targetX/Y: ${state.targetX.toFixed(2)}, ${state.targetY.toFixed(2)}
                irisX/Y: ${state.irisX.toFixed(2)}, ${state.irisY.toFixed(2)}
                targetDilation: ${state.targetDilation}
                dilation: ${state.dilation}
                cursorX/Y: ${(state.cursorX || 0).toFixed(0)}, ${(state.cursorY || 0).toFixed(0)}

                awake: ${state.awake}
                peeved: ${state.peeved}
                engrossed: ${state.engrossed}
                shy: ${state.shy}
                busy: ${state.busy}

                blink: ${state.blink.toFixed(2)}
                blinkTarget: ${state.blinkTarget}
                dilation: ${state.dilation.toFixed(2)}

                expression: ${state.currentExpr} → ${state.targetExpr}
                exprProgress: ${state.exprProgress.toFixed(2)}

                attentionThreshold: ${state.attentionThreshold.toFixed(0)}`;
        }

        // call it every frame - hook into existing tick or setInterval
        setInterval(updateStateReadout, 100);

        // Add to the script section
        document.getElementById('blink-toggle').addEventListener('change', (e) => {
            if (e.target.checked) {
                allowBlinking();
            } else {
                disallowBlinking();
            }
        });

        document.getElementById('track-toggle').addEventListener('change', (e) => {
            state.peeved = !e.target.checked;
            if (!e.target.checked) {
                state.targetX = 0;
                state.targetY = 0;
            }
        });

        document.getElementById('sleep-toggle').addEventListener('change', (e) => {
            state.sleepTimeout = e.target.checked ? 30 : Infinity;
        });

        document.getElementById('barCount').addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            document.getElementById('barCount-val').textContent = val;
            state.barCount = val;
        });

        document.getElementById('gapRatio').addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            document.getElementById('gapRatio-val').textContent = val.toFixed(2);
            state.gapRatio = val;
        });

        function syncControlsToState() {
            for (let key of Object.keys(state)) {
                key = key.replace(/_/g, '-');
                const el = document.getElementById(key);
                const label = document.getElementById(`${key}-val`);
                if (el) {
                    el.value = state[key];
                }
                if (label) {
                    label.textContent = state[key].toFixed(2);
                }
            }
        }

        setInterval(() => {
            updateStateReadout();
            syncControlsToState();
        }, 100);

        function setScale(val) {
            document.getElementById('scale-val').textContent = val + '%';
            document.getElementById('scale').value = val;
            svg.style.width = val + '%';
            svg.style.height = val + '%';
            setTimeout(updateDebugAxes, 10);  // update after layout settles
        }

        document.getElementById('scale').addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            setScale(val);
        });

        setScale(25);

        // Debug crosshair overlay
        const debugOverlay = document.getElementById('debug-overlay');
        const debugXAxis = document.getElementById('debug-x-axis');
        const debugYAxis = document.getElementById('debug-y-axis');

        function updateDebugAxes() {
            const rect = svg.getBoundingClientRect();
            const cx = rect.width / 2;
            const cy = rect.height / 2;
            
            // Position overlay exactly over the eye svg
            debugOverlay.style.left = rect.left + 'px';
            debugOverlay.style.top = rect.top + 'px';
            debugOverlay.style.width = rect.width + 'px';
            debugOverlay.style.height = rect.height + 'px';
            
            debugXAxis.setAttribute('x1', 0);
            debugXAxis.setAttribute('y1', cy);
            debugXAxis.setAttribute('x2', rect.width);
            debugXAxis.setAttribute('y2', cy);
            
            debugYAxis.setAttribute('x1', cx);
            debugYAxis.setAttribute('y1', 0);
            debugYAxis.setAttribute('x2', cx);
            debugYAxis.setAttribute('y2', rect.height);
        }

        document.getElementById('crosshair-toggle').addEventListener('change', (e) => {
            debugOverlay.style.display = e.target.checked ? 'block' : 'none';
            if (e.target.checked) updateDebugAxes();
        });
    </script>
</body>
</html>